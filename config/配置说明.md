# 配置文件说明

## coins_config.json

### 交易所配置 (exchange)

| 参数 | 说明 | 示例 | 支持的值 |
|------|------|------|----------|
| `exchange` | 交易所名称 | `"binance"` | `"binance"`, `"gateio"`, `"okx"`, `"bybit"` 等 |

**支持的交易所**（CCXT库支持100+交易所）：
- `binance` - 币安
- `gateio` - Gate.io (芝麻开门)
- `okx` - OKX (欧易)
- `bybit` - Bybit
- `huobi` / `htx` - 火币
- 更多交易所请参考：https://github.com/ccxt/ccxt#supported-exchanges

**切换交易所**：
1. 修改 `exchange` 字段为目标交易所名称（小写）
2. 在 `.env` 文件中设置对应的 API 凭证（见下方说明）
3. 重启程序

---

### 币种配置 (coins)

每个币种包含以下参数：

| 参数 | 说明 | 示例 |
|------|------|------|
| `symbol` | 交易对（CCXT统一格式） | `"BTC/USDT"`, `"ETH/USDT"` |
| `precision` | 数量精度（小数位数） | `3` = 0.001 BTC |
| `price_precision` | 价格精度（止损价格小数位数） | `2` = 保留2位小数 |
| `min_order_value` | 最小开仓金额（USDT） | `50` = 最少50 USDT |

**注意事项**：
- `symbol` 必须使用 CCXT 统一格式：`"币种/计价币"`（如 `"ETH/USDT"`）
- 不同交易所的交易对名称可能略有不同，请参考交易所文档
- `precision` 必须符合交易所要求，否则下单会被拒绝
- `min_order_value` 必须 ≥ 13 USDT（全局硬编码限制）
- 低价币（XRP、ADA、DOGE）需要更高的 `price_precision`（建议4位）

---

### 投资组合规则 (portfolio_rules)

| 参数 | 说明 | 默认值 | 可选值 |
|------|------|--------|--------|
| `leverage` | 杠杆倍数（全局设置） | `5` | 1-125 |
| `min_cash_reserve_percent` | 强制保留的资金比例 | `10` | 5-20 |
| `check_interval_minutes` | AI决策间隔（分钟） | `5` | 1-60 |

**参数详解**：

#### leverage（杠杆倍数）
- 程序启动时自动设置到币安账户
- 所有币种使用统一杠杆
- 修改后需重启程序生效
- **建议值**：3-10x（风险可控）

#### min_cash_reserve_percent（资金保留比例）
- 强制保留一定比例的资金作为缓冲
- 最大可用保证金 = 总资产 × (100 - 此值)% - 已用保证金
- 用于支付手续费和应对突发波动
- **建议值**：10%（默认）

#### check_interval_minutes（AI决策间隔）
- 控制多久调用一次 AI 进行决策
- 间隔越短，交易越频繁
- **建议值**：
  - `1-3` 分钟：激进，适合高频交易
  - `5` 分钟：平衡（默认）
  - `10-15` 分钟：稳健，适合趋势跟踪

---

## 配置示例

### 完整配置（Binance）
```json
{
  "exchange": "binance",
  "coins": [
    {
      "symbol": "BTC/USDT",
      "precision": 3,
      "price_precision": 2,
      "min_order_value": 50
    },
    {
      "symbol": "ETH/USDT",
      "precision": 3,
      "price_precision": 2,
      "min_order_value": 24
    }
  ],
  "portfolio_rules": {
    "leverage": 5,
    "min_cash_reserve_percent": 10,
    "check_interval_minutes": 5
  }
}
```

### Gate.io 配置示例
```json
{
  "exchange": "gateio",
  "coins": [
    {
      "symbol": "BTC/USDT",
      "precision": 3,
      "price_precision": 2,
      "min_order_value": 50
    },
    {
      "symbol": "ETH/USDT",
      "precision": 3,
      "price_precision": 2,
      "min_order_value": 24
    }
  ],
  "portfolio_rules": {
    "leverage": 5,
    "min_cash_reserve_percent": 10,
    "check_interval_minutes": 5
  }
}
```

### 激进配置（高频交易）
```json
{
  "portfolio_rules": {
    "leverage": 10,
    "min_cash_reserve_percent": 15,
    "check_interval_minutes": 1
  }
}
```

### 保守配置（稳健交易）
```json
{
  "portfolio_rules": {
    "leverage": 3,
    "min_cash_reserve_percent": 20,
    "check_interval_minutes": 15
  }
}
```

---

## 切换交易所

### 步骤

#### 1. 修改配置文件
编辑 `config/coins_config.json`，修改 `exchange` 字段：
```json
{
  "exchange": "gateio",  // 改为目标交易所
  "coins": [...]
}
```

#### 2. 设置API凭证
在 `.env` 文件中添加对应交易所的 API 密钥：

**Binance（币安）**：
```env
BINANCE_API_KEY=your_api_key
BINANCE_SECRET=your_api_secret
```

**Gate.io（芝麻开门）**：
```env
GATEIO_API_KEY=your_api_key
GATEIO_SECRET=your_api_secret
```

**OKX（欧易）**：
```env
OKX_API_KEY=your_api_key
OKX_SECRET=your_api_secret
OKX_PASSWORD=your_api_password
```

**Bybit**：
```env
BYBIT_API_KEY=your_api_key
BYBIT_SECRET=your_api_secret
```

#### 3. 验证交易对名称
不同交易所的交易对名称可能不同，请确认：
- 大多数交易所：`BTC/USDT`、`ETH/USDT`
- 某些交易所可能使用：`BTC/USD`、`BTCUSD` 等

建议使用测试脚本验证：
```bash
python3 test_ccxt_connection.py
```

#### 4. 重启程序
```bash
pkill -f portfolio_manager.py && ./scripts/start_portfolio.sh
```

### 注意事项

1. **杠杆限制**：不同交易所的杠杆倍数限制不同
   - Binance: 最高125x
   - Gate.io: 最高100x
   - OKX: 最高125x
   - Bybit: 最高100x

2. **手续费差异**：不同交易所的手续费率不同，影响盈利

3. **精度要求**：不同交易所对价格和数量精度要求可能不同

4. **最小订单金额**：各交易所的最小订单金额可能不同

5. **资金费率时间**：资金费率收取时间在不同交易所可能不同

6. **测试建议**：
   - 首次使用新交易所时，建议先用小额测试
   - 确认 API 权限已开启合约交易
   - 确认账户有足够余额

---

## 修改配置

### 步骤
1. 编辑配置文件：`vim config/coins_config.json`
2. 修改对应参数
3. 保存退出
4. 重启程序：`pkill -f portfolio_manager.py && ./scripts/start_portfolio.sh`

### 注意事项
- 修改杠杆后，程序会自动设置到币安
- 如果有持仓，修改杠杆可能会失败
- 建议在无持仓时修改配置

---

## 常见问题

### Q: 修改配置后没生效？
A: 确保已重启程序，配置只在启动时读取一次。

### Q: 杠杆设置失败？
A: 检查是否有持仓，建议平仓后再修改杠杆。

### Q: 最小开仓金额设置太低被拒绝？
A: 全局最小限制是 13 USDT，任何币种都不能低于此值。

### Q: 精度设置错误导致下单失败？
A: 参考交易所官方文档，或查看日志中的错误提示，调整 `precision` 和 `price_precision`。

### Q: 如何切换交易所？
A: 
1. 修改 `config/coins_config.json` 中的 `exchange` 字段
2. 在 `.env` 中设置对应交易所的 API 密钥
3. 运行 `python3 test_ccxt_connection.py` 测试连接
4. 重启程序

### Q: 切换到 Gate.io 后报错？
A: 
1. 检查 API 密钥是否正确配置在 `.env` 中
2. 确认 API 权限已开启合约交易
3. 验证交易对名称是否正确（大多数是 `BTC/USDT` 格式）
4. 检查账户是否有 USDT 余额

### Q: 支持哪些交易所？
A: CCXT 库支持 100+ 交易所，常用的有：
- Binance（币安）
- Gate.io（芝麻开门）
- OKX（欧易）
- Bybit
- Huobi/HTX（火币）
- Kraken
- KuCoin
- 等等

完整列表：https://github.com/ccxt/ccxt#supported-exchanges

### Q: 不同交易所的 API 密钥如何命名？
A: 建议命名规范（在 `.env` 文件中）：
- Binance: `BINANCE_API_KEY`, `BINANCE_SECRET`
- Gate.io: `GATEIO_API_KEY`, `GATEIO_SECRET`
- OKX: `OKX_API_KEY`, `OKX_SECRET`, `OKX_PASSWORD`
- Bybit: `BYBIT_API_KEY`, `BYBIT_SECRET`
