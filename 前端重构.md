# 前端重构和启动指南

## 一、项目概述

本次重构将 `duobizhong` 项目的 Web UI 从旧的 HTML/JS 页面升级为现代化的 React (TypeScript) 应用，并集成了 Tailwind CSS 进行样式设计。同时，增强了后端 Flask 应用，提供了新的 API 以支持前端的配置管理和 AI 提示词管理功能。

## 二、核心功能改动

1.  **现代化前端界面**：
    *   将 `web/` 目录下的旧前端替换为基于 React、Vite 和 Tailwind CSS 的新前端应用。
    *   提供了美观的仪表盘（Dashboard）和设置（Settings）页面。
    *   集成了深色模式。
    *   界面已完全汉化。

2.  **前端配置管理**：
    *   在 `Settings` 页面中，用户可以通过 UI 直接查看和修改 `config/coins_config.json` 文件中的投资组合规则和交易币种配置。
    *   支持动态添加和删除币种配置项。

3.  **AI 提示词管理**：
    *   在 `Settings` 页面中，新增了 AI 提示词管理面板。
    *   用户可以查看 `prompts/` 目录下所有 `.txt` 提示词文件列表。
    *   支持创建新的提示词文件。
    *   支持编辑和保存现有提示词文件内容。
    *   支持“载入并激活”功能：将选定的提示词文件的内容复制到 `prompts/default.txt`，从而让后端交易逻辑使用该提示词。

## 三、启动指南

请确保您处于项目根目录 `/home/xuano/ziyong/duobizhong`。

### 1. 启动后端 Flask 应用

后端 Flask 应用负责提供数据 API 和托管前端静态文件。

```bash
python3 web/web_app.py
```

**或使用快速启动脚本 (推荐)**

在 `web/` 目录下已为您创建 `start_web.sh` 脚本，它将自动构建前端并启动后端。

```bash
# 首次使用或权限不足时，需要添加执行权限
chmod +x web/start_web.sh

# 启动看板
web/start_web.sh
```

*   启动后，Flask 应用会在 `http://0.0.0.0:5000` 监听。
*   请保持此终端开启运行。

### 2. 构建前端 React 应用

前端 React 应用需要先构建成静态文件，才能被 Flask 后端托管。

```bash
cd web/ui && npm run build
```

*   此命令将编译 React 代码，并将生成的静态文件输出到 `web/dist` 目录。
*   在每次修改前端代码后，都需要重新执行此构建命令。**如果您使用 `web/start_web.sh` 脚本，此步骤将自动执行。**

### 3. 在浏览器中访问

完成以上两步后，打开您的浏览器，访问以下地址：

```
http://localhost:5000
```

您将看到全新的 AI Trading 仪表盘界面。

## 五、快速停止程序

如果您需要快速终止交易程序或看板程序，可以使用以下命令：

*   **杀死交易程序**：
    ```bash
    pkill -f portfolio_manager.py
    ```

*   **杀死看板程序**：
    ```bash
    pkill -f web_app.py
    ```

*   **（可选）终止看板的 tmux 会话**：
    如果您希望彻底关闭看板程序所在的 tmux 会话，可以使用：
    ```bash
    tmux kill-session -t web-dashboard
    ```
    (其中 `web-dashboard` 是 `web/start_web.sh` 脚本中定义的会话名称)

---

以下是本次重构中涉及的主要文件及修改摘要：

*   `web/web_app.py`：
    *   修改 `static_folder` 路径以托管 `web/dist` 目录。
    *   新增 `/api/prompts/list` (GET) 列出提示词文件。
    *   新增 `/api/prompts/content` (GET) 获取提示词内容。
    *   新增 `/api/prompts/save` (POST) 保存提示词内容。
    *   新增 `/api/prompts/activate` (POST) 激活提示词。

*   `web/ui/` (新增目录，包含整个 React 项目)：
    *   `package.json`：定义项目依赖（React, Vite, Tailwind CSS, react-router-dom, lucide-react 等）。
    *   `vite.config.ts`：Vite 构建配置。
    *   `tailwind.config.js`：Tailwind CSS 配置，启用深色模式。
    *   `postcss.config.js`：PostCSS 配置。
    *   `tsconfig.json`, `tsconfig.node.json`, `tsconfig.app.json`：TypeScript 配置。
    *   `index.html`：React 应用的入口 HTML 文件。
    *   `src/main.tsx`：React 入口文件，配置 `BrowserRouter`。
    *   `src/App.tsx`：主应用组件，配置路由，使用 `Layout` 组件。
    *   `src/components/Layout.tsx`：全局布局组件，包含侧边栏导航（已汉化，标题为 "AI Trading"）、深色模式切换和 `Outlet` 渲染子路由。
    *   `src/pages/Dashboard.tsx`：仪表盘页面，显示交易概览和持仓（已汉化，并集成 `/api/positions` 和 `/api/stats` API）。
    *   `src/pages/Settings.tsx`：设置页面，包含投资组合规则和交易币种配置表单，以及 AI 提示词管理面板（已汉化，并集成 `/api/config` 和 `/api/prompts/*` API）。
    *   `src/index.css`, `src/App.css`：基础样式文件。

**重要提示**：在进行任何前端代码修改后，请务必执行 `cd web/ui && npm run build` 命令重新构建，然后重新启动 Flask 应用，才能在浏览器中看到最新的更改。
在根目录duobizhong文件夹运行python3 web/web_app.py